{"version":3,"sources":["../../../src/renderer/views/file_form.js"],"names":["FileForm","props","onTitleChange","value","currentFile","callbacks","onChangeTitle","title","onContentChange","onChangeContent","content","toggleWatching","setState","oldState","editorState","setEditorState","togglePreview","state","componentWillUnmount","debouncedOnTitleChange","cancel","debouncedOnContentchange","componentWillReceiveProps","newProps","_id","refs","fileTitle","setValue","focus","fileContent","clearHistory","realForm","available","event","preventDefault","stopPropagation","target","padding","display","border","borderBottom","fontSize","width","boxSizing","propTypes","object"],"mappings":"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","file":"file_form.js","sourcesContent":["import React, {\n    Component,\n    PropTypes\n} from 'react';\nimport {\n    debounce\n} from '../../util';\nimport ReactDom from 'react-dom';\nimport NotePreview from './note_preview';\nimport NoteTitle from './note_title';\nimport ANoteEditor from './anote_editor';\n\nclass FileForm extends Component {\n  constructor(props) {\n    super(props);\n    this.debouncedOnTitleChange = debounce(this.onTitleChange, 200);\n    this.debouncedOnContentchange = debounce(this.onContentChange, 200);\n    this.state = {\n      oldState: null\n    };\n  }\n\n  onTitleChange = (value, currentFile) => {\n    if(this.props.callbacks && this.props.callbacks.onChangeTitle && currentFile.title != value)\n      this.props.callbacks.onChangeTitle(value, currentFile)\n  }\n\n  onContentChange = (value, currentFile) => {\n    if(value == null || currentFile == null)\n      return;\n    if(this.props.callbacks && this.props.callbacks.onChangeContent){\n      if(value != currentFile.content)\n        this.props.callbacks.onChangeContent(value, currentFile);\n    }\n  }\n\n  toggleWatching = () => {\n    this.setState({\n      oldState: this.props.editorState == 1 ? 0 : 1\n    });\n    this.props.setEditorState(this.props.editorState == 1 ? 0 : 1);\n  }\n\n  togglePreview = () => {\n    this.props.setEditorState(this.props.editorState == 2 ? this.state.oldState || 0 : 2);\n  }\n\n  componentWillUnmount = () => {\n    this.debouncedOnTitleChange.cancel();\n    this.debouncedOnContentchange.cancel();\n  }\n\n  componentWillReceiveProps = (newProps) => {\n    if((this.props.currentFile && this.props.currentFile._id) != (newProps.currentFile && newProps.currentFile._id)){\n      if(this.refs.fileTitle){\n        this.refs.fileTitle.setValue(newProps.currentFile.title);\n        this.refs.fileTitle.focus();\n        this.debouncedOnTitleChange.cancel();\n      }\n    }\n    if((this.props.currentFile && this.props.currentFile._id) != (newProps.currentFile && newProps.currentFile._id)){\n      if(this.refs.fileContent){\n        this.refs.fileContent.setValue(newProps.currentFile.content || '');\n        this.refs.fileContent.clearHistory();\n        this.debouncedOnContentchange.cancel();\n      }\n    }\n  }\n\n  // cause: defaultValue only a initial state, not updated by state or props, so, have to replace element by condition\n  // cause: key is very very important, key change will update the whole element. not just replace the attributes\n  // key={(this.props.currentFile && this.props.currentFile._id) || 'none'}\n  // 暂时去掉key的写法，用componentWillReceiveProps来手动赋值，提高editor的效率\n  render() {\n    let realForm = (\n                    this.props.available == 'true' ?\n                      <div>\n                        <NoteTitle\n                          autoFocus={true}\n                          onChange={(event) => {\n                            event.preventDefault();\n                            event.stopPropagation();\n                            this.debouncedOnTitleChange(event.target.value, this.props.currentFile);\n                          }}\n                          defaultValue={(this.props.currentFile && this.props.currentFile.title)}\n                          ref='fileTitle'\n                          style={{\n                            padding: '11px 8px 12px 8px',\n                            display: 'block',\n                            border: 'none',\n                            borderBottom: '1pz solid #808080',\n                            fontSize: '16px',\n                            width: '100%',\n                            boxSizing: 'border-box'\n                          }}\n                        />\n                        <div className='editor-wrapper'>\n                          {/* anote editor */}\n                          <ANoteEditor\n                            defaultValue={this.props.currentFile && this.props.currentFile.content}\n                            ref='fileContent'\n                            editorState={this.props.editorState}\n                            toggleWatching={this.toggleWatching}\n                            togglePreview={this.togglePreview}\n                            onChange={(value) => {\n                              this.debouncedOnContentchange(value, (this.props && this.props.currentFile) || null)\n                            }}\n                          />\n                        </div>\n                      </div>\n                    :\n                    <NotePreview\n                      key={this.props.currentFile._id}\n                      currentFile={this.props.currentFile}\n                    />\n                  );\n    return (\n      this.props.currentFile && this.props.currentFile._id ? realForm : <div/>\n    );\n  }\n}\n\nFileForm.propTypes = {\n  currentFile: PropTypes.object,\n  callbacks: PropTypes.object\n}\n\nexport default FileForm;\n"]}