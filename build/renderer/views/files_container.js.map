{"version":3,"sources":["../../../src/renderer/views/files_container.js"],"names":["ipcRenderer","require","mapStateToProps","state","files","currentFile","activeFile","globalBook","books","editorState","mapDispatchToProps","dispatch","addFile","file","listFiles","delFile","concatFiles","editFile","setGlobalBook","book","listBooks","setEditorState","FilesContainer","props","debouncedSaveFileToDb","saveFileToDb","location","query","bookId","_id","name","bookName","confirmationOpen","confirmString","confirmationTmpData","listMenuOpen","currentBookId","listMenuTmpData","menuMoveToNotebook","menuCopyToNotebook","menuMoveToTrash","menuClearFile","menuRestoreFile","_checkNewNoteParam","_fetchFiles","_fetchBooks","send","on","_addNoteFromTray","newProps","searchFileText","available","params","id","length","getCurrentFile","_ensureGlobalBook","filter","cancel","removeAllListeners","event","onContextMenu","newAndCreateFile","width","lineHeight","height","color","border","position","zIndex","dropdownMenuValue","dropdownMenuChange","marginTop","backgroundColor","fontSize","textAlign","_availableBooks","map","children","cloneElement","callbacks","onChangeContent","onChangeTitle","onCancelConfirmationDialog","onOkConfirmationDialog","listMenuCancel","listMenuOk","menuListFilter","moveToNotebook","findIndex","copyToNotebook","clearFile","restoreFile","newFile","newNote","_delNewNoteParam","replace","pathname","Object","assign","that","searchConditions","sortConditions","$or","title","$regex","RegExp","content","find","sort","exec","err","fls","Error","_processJump","bks","firstBook","_unavailableBooks","push","console","log","preventDefault","stopPropagation","insert","error","result","isInBook","value","update","$set","_fileAttributes","upsert","multi","index","setState","fileId","callback","delFileOk","tmpData","_processDelAndJump","clearFileOk","remove","clearTrash","clearTrashOk","findBook","tmpBook","restoreFileOk","customerFunc","tmpFile","fileLength","chooseFile","canNew","importFile","normalExport","exportAsPdf","deleteFile","tmpIdx","type","dataItem","currentDataItem","checkedId","_moveFile","_copyFile"],"mappings":"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","file":"files_container.js","sourcesContent":["import React, {\n    Component\n} from 'react';\nimport {\n    connect\n} from 'react-redux';\nimport ReactDom from 'react-dom';\nimport {\n    listFiles,\n    addFile,\n    delFile,\n    concatFiles,\n    editFile,\n    activeFile,\n    setGlobalBook,\n    listBooks,\n    setEditorState\n} from '../actions';\nimport {\n    files,\n    books,\n    tags\n} from '../../main/set_db';\nimport {\n    hashHistory\n} from 'react-router';\nimport FilesList from './files_list';\nimport FileForm from './file_form';\nimport FlatButton from 'material-ui/FlatButton';\nimport {\n    debounce,\n    pick\n} from '../../util';\nimport {\n  openFileItemContextMenu\n} from '../controllers/files_controller.js';\nimport ConfirmDialog from './confirm_dialog';\nimport ListMenu from './list_menu';\nimport DropDownMenu from 'material-ui/DropDownMenu';\nimport MenuItem from 'material-ui/MenuItem';\nimport Divider from 'material-ui/Divider';\nconst ipcRenderer = require('electron').ipcRenderer;\nimport util from 'util';\nimport { setDispatchHandler } from '../dispatch_handlers';\nimport { sendWorkerCmd } from '../worker_util';\nimport singleEvent from '../single_event';\nimport Spinner from './spinner'\n\nconst mapStateToProps = (state) => {\n  return {\n    files: state.files,\n    currentFile: state.activeFile,\n    globalBook: state.globalBook,\n    books: state.books,\n    editorState: state.editorState\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    addFile: (file) => {\n      dispatch(addFile(file));\n    },\n    listFiles: (files) => {\n      dispatch(listFiles(files));\n    },\n    delFile: (file) => {\n      dispatch(delFile(file));\n    },\n    concatFiles: (files) => {\n      dispatch(concatFiles(files));\n    },\n    editFile: (file) => {\n      dispatch(editFile(file));\n    },\n    activeFile: (file) => {\n      dispatch(activeFile(file));\n    },\n    setGlobalBook: (book) => {\n      dispatch(setGlobalBook(book));\n    },\n    listBooks: (books) => {\n      dispatch(listBooks(books));\n    },\n    setEditorState: (state) => {\n      dispatch(setEditorState(state));\n    }\n  }\n}\n\nclass FilesContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.debouncedSaveFileToDb = debounce(this.saveFileToDb, 200);\n    if(this.props.location.query.bookId){\n      this.props.setGlobalBook({\n        _id: this.props.location.query.bookId,\n        name: this.props.location.query.bookName\n      });\n    }\n    this.state = {\n      // for confirmation dialog\n      confirmationOpen: false,\n      confirmString: '',\n      confirmationTmpData: {},\n      // for copy and past menu\n      listMenuOpen: false,\n      currentBookId: null,\n      listMenuTmpData: {}\n    };\n    setDispatchHandler('moveToNotebook', this.menuMoveToNotebook);\n    setDispatchHandler('copyToNotebook', this.menuCopyToNotebook);\n    setDispatchHandler('moveToTrash', this.menuMoveToTrash);\n    setDispatchHandler('clearFile', this.menuClearFile);\n    setDispatchHandler('restoreFile', this.menuRestoreFile);\n  }\n\n\n  menuMoveToNotebook = () => {\n    this.moveToNotebook(this.props.currentFile, this.props.files.findIndex((file) => {\n      return file._id == this.props.currentFile._id;\n    }));\n  }\n\n  menuCopyToNotebook = () => {\n    this.copyToNotebook(this.props.currentFile, this.props.files.findIndex((file) => {\n      return file._id == this.props.currentFile._id;\n    }));\n  }\n\n  menuMoveToTrash = () => {\n    this.delFile(this.props.currentFile, this.props.files.findIndex((file) => {\n      return file._id == this.props.currentFile._id;\n    }));\n  }\n\n  menuClearFile = () => {\n    this.clearFile(this.props.currentFile, this.props.files.findIndex((file) => {\n      return file._id == this.props.currentFile._id;\n    }));\n  }\n\n  menuRestoreFile = () => {\n    this.restoreFile(this.props.currentFile, this.props.files.findIndex((file) => {\n      return file._id == this.props.currentFile._id;\n    }));\n  }\n\n  // this hook method is not always recalled when url changed\n  // this decided by react diff and replace strategy\n  componentDidMount() {\n    this._checkNewNoteParam();\n    this._fetchFiles();\n    this._fetchBooks();\n    ipcRenderer.send('onNoEditNotesList');\n    singleEvent.on('addNoteFromTray', this._addNoteFromTray);\n  }\n\n  _addNoteFromTray = (newFile) => {\n    if(!this.props.location.query.available)\n      return;\n    if(this.props.location.query.searchFileText && this.props.location.query.searchFileText != '')\n      return;\n    if(this.props.location.query.bookId && this.props.location.query.bookId != newFile.bookId)\n      return;\n    this.props.addFile(newFile);\n  }\n\n  // cause: use newProps, because this.props has not been updated !!!!\n  componentWillReceiveProps(newProps) {\n    // 用于新建note\n    this._checkNewNoteParam(newProps);\n\n    // 确保files最新\n    if(this.props.location.query.bookId != newProps.location.query.bookId){\n      this._fetchFiles(newProps);\n      if(newProps.location.query.bookId){\n        this.props.setGlobalBook({\n          _id: newProps.location.query.bookId,\n          name: newProps.location.query.bookName\n        });\n      }\n    }\n\n    // searchFileText change 重新 fetch 数据\n    if(this.props.location.query.searchFileText != newProps.location.query.searchFileText\n        || this.props.location.query.available != newProps.location.query.available){\n      this._fetchFiles(newProps);\n    }\n\n    // 确保currentfile最新，由于我们用一个页面相同元素换属性来展示页面，所以不是替换元素，出发不了componentDidMount\n    if(newProps.files != this.props.files || newProps.params.id != this.props.params.id){\n      if(newProps.params.id && newProps.files.length > 0){\n        this.getCurrentFile(newProps);\n      }\n    }\n\n    // 确保有book可以新建文章\n    if(newProps.books != this.props.books)\n      this._ensureGlobalBook(newProps.books.filter((book) => {\n        return book.available;\n      })[0]);\n  }\n\n  componentWillUnmount() {\n    this.debouncedSaveFileToDb.cancel();\n    setDispatchHandler('moveToNotebook', null);\n    setDispatchHandler('copyToNotebook', null);\n    setDispatchHandler('moveToTrash', null);\n    setDispatchHandler('clearFile', null);\n    setDispatchHandler('restoreFile', null);\n    singleEvent.removeAllListeners('addNoteFromTray');\n  }\n\n  _checkNewNoteParam = (props) => {\n    props = props || this.props;\n    if(props.location.query.newNote == 'true'){\n      // 保证只开一次新建的dialog\n      this._delNewNoteParam();\n      this.newAndCreateFile();\n      return true;\n    }\n    return false;\n  }\n\n  _delNewNoteParam = () => {\n    hashHistory.replace({\n      pathname: this.props.location.pathname,\n      query: Object.assign({}, pick(this.props.location.query, 'searchFileText', 'bookId', 'bookName'), {available: true})\n    });\n  }\n\n  _fetchFiles = (newProps) => {\n    let that = this,\n      searchConditions = null,\n      sortConditions = { 'updatedAt': -1 },\n      props = newProps || this.props;\n    if(props.location.query.bookId) {\n      searchConditions = { bookId: props.location.query.bookId, available: true };\n    }else if(props.location.query.searchFileText) {\n      searchConditions = { $or: [ { title: { $regex: new RegExp(props.location.query.searchFileText, 'i') } }, { content: { $regex: new RegExp(props.location.query.searchFileText, 'i') } } ], available: true };\n    }else if(props.location.query.available == 'false') {\n      searchConditions = { available: false };\n    }else {\n      searchConditions = { available: true };\n    }\n    files.find(searchConditions).sort(sortConditions).exec( (err, fls) => {\n      if(err)\n        throw new Error('search file error');\n      that.props.listFiles(fls);\n      that._processJump(fls);\n    });\n  }\n\n  // 如果没有book数据，就需要fetch book的数据\n  _fetchBooks = () => {\n    var that = this;\n    if(this.props.books.length == 0){\n      books.find({}).sort({ 'updatedAt': -1 }).exec((err, bks) => {\n        that.props.listBooks(bks);\n      });\n    }else{\n      this._ensureGlobalBook();\n    }\n  }\n\n  _ensureGlobalBook = (book) => {\n    let firstBook = null;\n    if(!this.bookId() && (firstBook = book || this._availableBooks()[0])){\n      this.props.setGlobalBook({\n        _id: firstBook._id,\n        name: firstBook.name\n      });\n    }\n  }\n\n  _availableBooks = () => {\n    return this.props.books.filter((book) => {\n      return book.available;\n    });\n  }\n\n  _unavailableBooks = () => {\n    return this.props.books.filter((book) => {\n      return !book.available;\n    });\n  }\n\n  // decide where to go\n  _processJump = (fls) => {\n    if(this.props.params.id)\n      return;\n    if(fls.length > 0){\n      hashHistory.push({ pathname: `/notes/${fls[0]._id}/edit`, query: this.props.location.query });\n    }\n  }\n\n  getCurrentFile = (newProps) => {\n    console.log('getCurrentFile');\n    let currentFile = newProps.files.find((file) => {\n      return file._id == newProps.params.id;\n    }) || {};\n    this.debouncedSaveFileToDb.cancel();\n    this.props.activeFile(currentFile);\n    if(currentFile._id && this.props.location.query.available == 'true'){\n      ipcRenderer.send('onEditNote');\n    }else if(currentFile._id && this.props.location.query.available == 'false'){\n      ipcRenderer.send('onEditTrash');\n    }\n    console.log(currentFile);\n    return currentFile;\n  }\n\n  newAndCreateFile = (event) => {\n    if(event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n    // only can create note when there is bookId\n    if(!this.bookId()){\n      return;\n    }\n    files.insert({bookId: this.bookId(), available: true}, (error, newFile) => {\n      if(error) {\n        throw error;\n        return;\n      }\n      if(this.props.location.query.available == 'true') {\n        this.props.addFile(newFile);\n      }\n      hashHistory.push({ pathname: `/notes/${newFile._id}/edit`, query: this.props.location.query});\n    });\n  }\n\n  // 用于新建的bookId\n  bookId = () => {\n    let result = this.props.location.query.bookId || this.props.globalBook._id;\n    return result;\n  }\n\n  isInBook = () => {\n    return this.props.location.query.bookId;\n  }\n\n  onChangeContent = (content, file) => {\n    this.debouncedSaveFileToDb(Object.assign({}, file, {content: content}));\n  }\n\n  onChangeTitle = (value, file) => {\n    this.debouncedSaveFileToDb(Object.assign({}, file, {title: value}));\n  }\n\n  saveFileToDb = (file) => {\n    var that = this;\n    that.props.editFile(file);\n    files.update({'_id': file._id}, {$set: that._fileAttributes(file)}, {upsert: false, multi: false}, (error) => {\n      if(error){\n        throw error;\n        return;\n      }\n    });\n  }\n\n  _fileAttributes = (file) => {\n    return pick(file, 'title', 'content');\n  }\n\n  delFile = (file, index) => {\n    this.setState({\n      confirmationOpen: true,\n      confirmString: `Are you sure you want to delete the note '${file.title || \"Untitled\"}'`,\n      confirmationTmpData: {fileId: file._id, index: index, callback: 'delFileOk'}\n    });\n  }\n\n  delFileOk = (tmpData) => {\n    let that = this;\n    files.update({ _id: tmpData.fileId }, {$set: {available: false}}, {}, function(error) {\n      if(error) {\n        throw error;\n        return;\n      }\n      that._processDelAndJump(tmpData.index, tmpData.fileId, () => {\n        that.setState({\n          confirmationOpen: false\n        });\n      });\n    });\n  }\n\n  clearFile = (file, index) => {\n    this.setState({\n      confirmationOpen: true,\n      confirmString: `Are you sure you want to delete forever the note '${file.title || \"Untitled\"}'`,\n      confirmationTmpData: {fileId: file._id, index: index, callback: 'clearFileOk'}\n    });\n  }\n\n  clearFileOk = (tmpData) => {\n    let that = this;\n    files.remove({ _id: tmpData.fileId }, {}, function(error) {\n      if(error) {\n        throw error;\n        return;\n      }\n      that._processDelAndJump(tmpData.index, tmpData.fileId, () => {\n        that.setState({\n          confirmationOpen: false\n        });\n      });\n    });\n  }\n\n  clearTrash = (file, index) => {\n    this.setState({\n      confirmationOpen: true,\n      confirmString: 'Are you sure you want to clear trash',\n      confirmationTmpData: {callback: 'clearTrashOk'}\n    });\n  }\n\n  clearTrashOk = () => {\n    let that = this;\n    files.remove({available: false}, {multi: true}, (err) => {\n      that.props.listFiles([]);\n      hashHistory.push({pathname: '/notes', query: {available: false}});\n      that.setState({\n        confirmationOpen: false\n      });\n    })\n  }\n\n  findBook = (bookId) => {\n    return this.props.books.filter((book) => {\n      return book._id == bookId;\n    })[0];\n  }\n\n  restoreFile = (file, index) => {\n    let tmpBook = this.findBook(file.bookId);\n    this.setState({\n      confirmationOpen: true,\n      confirmString: `Are you sure you want to restore the note '${file.title || \"Untitled\"}' to ${(tmpBook && tmpBook.name) || 'original book'}`,\n      confirmationTmpData: {fileId: file._id, index: index, callback: 'restoreFileOk', file: file}\n    });\n  }\n\n  restoreFileOk = (tmpData) => {\n    let that = this;\n    let tmpBook = this.findBook(tmpData.file.bookId);\n    if(tmpBook && !tmpBook.available){\n      books.update({ _id: tmpBook._id }, {$set: {available: true}}, {}, function(error) {\n        if(error) {\n          throw error;\n          return;\n        }\n        files.update({ _id: tmpData.fileId }, {$set: {available: true}}, {}, function(error) {\n          if(error) {\n            throw error;\n            return;\n          }\n          that._processDelAndJump(tmpData.index, tmpData.fileId, () => {\n            that.setState({\n              confirmationOpen: false\n            });\n          });\n        });\n      });\n    }else{\n      files.update({ _id: tmpData.fileId }, {$set: {available: true}}, {}, function(error) {\n        if(error) {\n          throw error;\n          return;\n        }\n        that._processDelAndJump(tmpData.index, tmpData.fileId, () => {\n          that.setState({\n            confirmationOpen: false\n          });\n        });\n      });\n    }\n  }\n\n  onOkConfirmationDialog = (event, tmpData) => {\n    this[tmpData.callback](tmpData);\n  }\n\n  // process delete action and jump\n  _processDelAndJump = ( index, fileId, customerFunc ) => {\n    console.log('_processDelAndJump');\n    console.log(index, fileId);\n    let tmpFile = null,\n      fileLength = this.props.files.length;\n    if(fileLength > 1 && index == fileLength-1) {\n      tmpFile = this.props.files[0];\n    }else if(fileLength > 1){\n      tmpFile = this.props.files[index+1];\n    }\n    this.props.delFile({_id: fileId});\n    if(customerFunc)\n      customerFunc();\n    if(fileLength == 1)\n      return hashHistory.push({ pathname: '/notes', query: this.props.location.query });\n    hashHistory.push({ pathname: `/notes/${tmpFile._id}/edit`, query: this.props.location.query });\n  }\n\n  onCancelConfirmationDialog = () => {\n    this.setState({\n      confirmationOpen: false\n    });\n  }\n\n  onContextMenu = (file, index) => {\n    let chooseFile = file ? true : false;\n    let canNew = this.bookId() ? true : false;\n    openFileItemContextMenu(\n      this.props.location.query.available,\n      canNew,\n      chooseFile,\n      {\n        importFile: () => {\n          sendWorkerCmd('importFile');\n        },\n        newFile: () => {\n          this.newAndCreateFile();\n        },\n        moveToNotebook: () => {\n          this.moveToNotebook(file, index);\n        },\n        copyToNotebook: () => {\n          this.copyToNotebook(file, index);\n        },\n        normalExport: () => {\n          sendWorkerCmd('saveNoteAsMarkdown', file._id);\n        },\n        exportAsPdf: () => {\n          sendWorkerCmd('saveNoteAsPdf', file._id);\n        },\n        deleteFile: () => {\n          this.delFile(file, index);\n        },\n        clearFile: () => {\n          this.clearFile(file, index);\n        },\n        restoreFile: () => {\n          console.log('restore');\n          this.restoreFile(file, index);\n        },\n        clearTrash: () => {\n          this.clearTrash();\n        }\n      }\n    );\n  }\n\n  moveToNotebook = (file, index) => {\n    let tmpIdx = this._availableBooks().findIndex((book) => {\n      return book._id == file.bookId;\n    });\n    this.setState({\n      currentBookId: this._availableBooks()[tmpIdx]._id,\n      listMenuOpen: true,\n      listMenuTmpData: {\n        file: file,\n        type: 'move',\n        index: index\n      }\n    });\n  }\n\n  copyToNotebook = (file, index) => {\n    let tmpIdx = this._availableBooks().findIndex((book) => {\n      return book._id == file.bookId;\n    });\n    this.setState({\n      currentBookId: this._availableBooks()[tmpIdx]._id,\n      listMenuOpen: true,\n      listMenuTmpData: {\n        file: file,\n        type: 'copy',\n        index: index\n      }\n    });\n  }\n\n  menuListFilter = (dataItem, currentDataItem) => {\n    return dataItem.id == currentDataItem;\n  }\n\n  listMenuCancel = () => {\n    this.setState({\n      listMenuOpen: false\n    });\n  }\n\n  listMenuOk = (event, checkedId, tmpData) => {\n    this[`_${tmpData.type}File`](tmpData, checkedId);\n  }\n\n  // move file to other notebook\n  _moveFile = ({file, index}, bookId) => {\n    var that = this;\n    files.update({ _id: file._id }, { $set: { bookId: bookId } }, {}, function(error) {\n      if(error){\n        throw error;\n        return;\n      }\n      that._processDelAndJump( index, file._id, () => {\n        that.setState({\n          listMenuOpen: false\n        });\n      });\n    })\n  }\n\n  // copy file to other notebook\n  _copyFile = ({file, index}, bookId) => {\n    var that = this;\n    files.insert(Object.assign(\n      {\n        available: true,\n        bookId: bookId\n      },\n      that._fileAttributes(file)\n    ), (error, newFile) => {\n      that.setState({\n        listMenuOpen: false\n      });\n    });\n  }\n\n  dropdownMenuChange = (event, index, value) => {\n    if(value == this.dropdownMenuValue())\n      return;\n    if(value == 'trash') {\n      return hashHistory.push({\n        pathname: '/notes',\n        query: {\n          available: false\n        }\n      });\n    }\n    if(value == 'all') {\n      return hashHistory.push({\n        pathname: '/notes',\n        query: {\n          available: true\n        }\n      });\n    }\n    let tmpBook = this.findBook(value);\n    if(tmpBook)\n      return hashHistory.push({\n        pathname: '/notes',\n        query: {\n          bookId: tmpBook._id,\n          bookName: tmpBook.name,\n          available: true\n        }\n      });\n  }\n\n  dropdownMenuValue = () => {\n    if(this.props.location.query.available == 'false') {\n      return 'trash';\n    }\n    if(this.props.location.query.bookId) {\n      return this.props.location.query.bookId;\n    }\n    return 'all';\n  }\n\n  render() {\n    return (\n      <div className='work-wrapper'>\n        <div\n          className='sec-sidebar'\n          onContextMenu={(event) => {this.onContextMenu();}}\n        >\n          <FlatButton\n            label={this.bookId() ? `NEW NOTE IN ${this.props.globalBook.name}` : 'NEW A BOOK First!!'}\n            onClick={this.newAndCreateFile}\n            primary={true}\n            backgroundColor={this.bookId() ? 'rgba(255, 255, 255, 1)' : '#ddd'}\n            style={{\n              width: '295px',\n              lineHeight: '40px',\n              height: '42px',\n              color: '#3d3d3d',\n              border: '1px solid #ddd',\n              position: 'fixed',\n              zIndex: 100\n            }}\n          />\n          <DropDownMenu\n            value={this.dropdownMenuValue()}\n            onChange={this.dropdownMenuChange}\n            style={{\n              zIndex: 100,\n              marginTop: '43px',\n              width: '294px',\n              position: 'fixed',\n              color: '#3d3d3d',\n              border: '1px solid #ddd',\n              backgroundColor: 'white',\n              fontSize: '16px',\n              lineHeight: '16px',\n              textAlign: 'center'\n            }}\n            maxHeight={300}\n          >\n            {\n              this._availableBooks().map((book) => {\n                return (\n                  <MenuItem\n                    key={book._id}\n                    value={book._id}\n                    primaryText={book.name}\n                  />\n                )\n              })\n            }\n            <Divider/>\n            <MenuItem\n              value='all'\n              primaryText='All'\n            />\n            <MenuItem\n              value='trash'\n              primaryText='Trash'\n            />\n          </DropDownMenu>\n          <FilesList\n            files={this.props.files}\n            query={this.props.location.query}\n            onContextMenu={this.onContextMenu}\n          />\n        </div>\n        <div className='work-pane'>\n          {\n            this.props.children && React.cloneElement(this.props.children, {\n              currentFile: this.props.currentFile,\n              editorState: this.props.editorState,\n              setEditorState: this.props.setEditorState,\n              available: this.props.location.query.available,\n              callbacks: {\n                onChangeContent: this.onChangeContent,\n                onChangeTitle: this.onChangeTitle\n              }\n            })\n          }\n        </div>\n        <ConfirmDialog\n          cancelString='Cancel'\n          okString='Ok'\n          onCancel={this.onCancelConfirmationDialog}\n          onOk={this.onOkConfirmationDialog}\n          title= ''\n          open={this.state.confirmationOpen}\n          confirmString={this.state.confirmString}\n          tmpData={this.state.confirmationTmpData}\n        />\n        <ListMenu\n          cancelString='Cancel'\n          okString='Ok'\n          onCancel={this.listMenuCancel}\n          onOk={this.listMenuOk}\n          title=''\n          open={this.state.listMenuOpen}\n          dataList={this._availableBooks().map((book) => { return {name: book.name, id: book._id} })}\n          dataItem={this.state.currentBookId}\n          filterFunc={this.menuListFilter}\n          tmpData={this.state.listMenuTmpData}\n        />\n      </div>\n    );\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(FilesContainer);\n"]}