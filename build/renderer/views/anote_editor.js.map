{"version":3,"sources":["../../../src/renderer/views/anote_editor.js"],"names":["FILES_PATH","clipboard","require","fs","toMarkdown","sanitizeHtml","pastImage","cm","console","log","image","readImage","isEmpty","text","readText","toPNG","then","key","replaceSelection","length","pastHtml","component","htmlText","readHTML","test","cleanText","allowedTags","selfClosing","allowedAttributes","tmpContent","converters","filter","replacement","content","node","src","regex","replace","showSpinner","hideSpinner","pastText","ANoteEditor","props","state","previewValue","defaultValue","fullscreen","debouncedSetPreviewValue","setPrevewValue","textAreaElement","findDOMNode","refs","textArea","$imageInput","$","imageInput","window","editor","fromTextArea","theme","mode","lineWrapping","lineNumbers","setKeyMaps","setSize","on","instance","changeObj","editorState","getValue","onChange","setValue","change","event","files","target","i","path","hashKey","name","newProps","_anoteClassNames","withoutToolbar","_renderTools","display","position","top","right","_anotePreviewCloseBtnStyle","togglePreview","componentWillUnmount","cancel","setState","defaultKeyMaps","that","execCommand","doc","getDoc","undo","redo","preview","value","jQuery","val","clearHistory","Object","assign","keyMaps","setOption","performEditor","method","args","slice","apply","insertImage","preventDefault","stopPropagation","trigger","changeBold","changeItalics","insertUl","insertOl","insertHr","toggleWatching","_anoteWatchingClassNames","toggleFullscreen","getSelection","klasses"],"mappings":"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","file":"anote_editor.js","sourcesContent":["import path from 'path';\nimport co from 'co';\nimport React, {\n  Component\n} from 'react';\nimport {\n  copyFile,\n  getFileHash,\n  hash2Key,\n  buffer2File,\n  debounce,\n  placeImageToLocalAsyn,\n  downloadAsyn\n} from '../../util';\nlet {\n    FILES_PATH\n} = constants;\nconst clipboard = require('electron').clipboard;\nconst fs = require('fs');\nconst toMarkdown = require('to-markdown');\nconst sanitizeHtml = require('sanitize-html');\nimport Spinner from './spinner'\nimport constants from '../../constants';\nimport ReactDom from 'react-dom';\n\nimport CodeMirror from 'codemirror';\nrequire('codemirror/addon/dialog/dialog.js');\nrequire('codemirror/addon/search/searchcursor.js');\nrequire('codemirror/addon/search/search.js');\nrequire('codemirror/addon/scroll/annotatescrollbar.js');\nrequire('codemirror/addon/search/matchesonscrollbar.js');\nrequire('codemirror/addon/search/jump-to-line.js');\n\n\nimport ANotePreview from './anote_preview'\nrequire('codemirror/mode/markdown/markdown');\n\n// for past image\nfunction pastImage(cm) {\n  console.log('pastImage');\n  let image = clipboard.readImage();\n  if(image && !image.isEmpty()){\n    let text = clipboard.readText();\n    buffer2File(image.toPNG()).then(function(key){\n      cm.replaceSelection(\"![\" + (text.length == 0 ? 'past-image' : text) + \"](\" + key + \")\");\n    });\n    return true;\n  }\n  return false;\n}\n\n// for past html(html2markdown)\nfunction pastHtml(cm, component) {\n  let htmlText = clipboard.readHTML();\n  //这里electron的坑不小，它也判断不太好是html还是text\n  if(!/<[a-z][\\s\\S]*>/i.test(htmlText))\n    return false;\n  let cleanText = sanitizeHtml(htmlText, {\n    allowedTags: [ 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'p', 'a', 'ul', 'ol',\n  'nl', 'li', 'b', 'i', 'strong', 'em', 'strike', 'code', 'hr', 'br',\n  'table', 'thead', 'tbody', 'tr', 'th', 'td', 'pre', 'img'],\n    selfClosing: ['br', 'hr', 'base', 'img'],\n    allowedAttributes: {\n      'a': [ 'href' ],\n      'img': [ 'src' ]\n    }\n  });\n  if(htmlText && htmlText.length > 0){\n    let tmpContent = toMarkdown(cleanText, {\n      converters: [\n        {\n          filter: 'code',\n          replacement: function(content) {\n            return '`' + content + '`';\n          }\n        },\n        {\n          filter: 'img',\n          replacement: function(content, node) {\n            // need add back worker\n            return \"![\" + 'web-image' + \"](\" + node.src + \")\"\n          }\n        }\n      ]\n    });\n    let regex = /(<([^>]+)>)/ig;\n    tmpContent = tmpContent.replace(regex, '');\n    component.showSpinner();\n    placeImageToLocalAsyn(tmpContent).then(function(content) {\n      component.hideSpinner();\n      cm.replaceSelection(content);\n    }, function () {\n      component.hideSpinner();\n    });\n    // cm.replaceSelection(tmpContent);\n    return true;\n  }\n  return false\n}\n\n// past text\nfunction pastText(cm) {\n  let text = clipboard.readText();\n  if(text && text.length > 0){\n    cm.replaceSelection(text);\n  }\n}\n\nclass ANoteEditor extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showSpinner: false,\n      previewValue: this.props.defaultValue,\n      fullscreen: false\n    };\n\n    this.debouncedSetPreviewValue = debounce(this.setPrevewValue, 50);\n  }\n\n  componentWillUnmount = () => {\n    this.debouncedSetPreviewValue.cancel();\n  }\n\n  setPrevewValue = (previewValue) => {\n    this.setState({\n      previewValue\n    });\n  }\n\n  showSpinner = () => {\n    this.setState({\n      showSpinner: true\n    });\n  }\n\n  hideSpinner = () => {\n    this.setState({\n      showSpinner: false\n    });\n  }\n\n  defaultKeyMaps = () => {\n    let that = this;\n    return {\n      \"Ctrl-P\": function(cm) {\n        cm.execCommand(\"goLineUp\");\n      },\n      \"Ctrl-N\": function(cm) {\n        cm.execCommand(\"goLineDown\");\n      },\n      \"Ctrl-A\": function(cm) {\n        cm.execCommand(\"goLineStart\");\n      },\n      \"Ctrl-E\": function(cm) {\n        cm.execCommand(\"goLineEnd\");\n      },\n      \"Ctrl-K\": function(cm) {\n        cm.execCommand(\"killLine\");\n      },\n      \"Ctrl-F\": function(cm) {\n        cm.execCommand(\"goColumnRight\");\n      },\n      \"Ctrl-B\": function(cm) {\n        cm.execCommand(\"goColumnLeft\");\n      },\n      \"Alt-F\": function(cm) {\n        cm.execCommand(\"goWordRight\");\n      },\n      \"Alt-B\": function(cm){\n        cm.execCommand(\"goWordLeft\");\n      },\n      // 自动判断文本格式来粘贴\n      \"Cmd-V\": function(cm){\n        if(pastImage(cm)){\n          return;\n        }\n        if(pastHtml(cm, that)){\n          return;\n        }\n        pastText(cm);\n      },\n      \"Cmd-Z\": function(cm){\n        let doc = cm.getDoc();\n        if(doc)\n          doc.undo();\n      },\n      \"Cmd-Y\": function(cm){\n        let doc = cm.getDoc();\n        if(doc)\n          doc.redo();\n      },\n      // 粘贴纯文本\n      \"Alt-V\": function(cm) {\n        pastText(cm);\n      },\n      \"Cmd-S\": function(cm) {\n        if(that.props.onChange)\n          that.props.onChange(cm.getValue());\n      },\n      \"Cmd-F\": \"findPersistent\"\n    };\n  }\n\n  componentDidMount() {\n    // init editor\n    this.textAreaElement = ReactDom.findDOMNode(this.refs.textArea);\n    this.$imageInput = $(ReactDom.findDOMNode(this.refs.imageInput));\n\n    window.editor = this.editor = CodeMirror.fromTextArea(this.textAreaElement, {\n      theme: 'base16-light',\n      mode: 'markdown',\n      lineWrapping: true,\n      lineNumbers: true\n    });\n\n    // set keymaps\n    this.setKeyMaps();\n\n    // setsize based on the editorState prop\n    this.setSize();\n\n    // change event\n    this.editor.on('change', (instance, changeObj) => {\n      if(this.props.editorState == 1 || this.editorState == 2)\n        this.debouncedSetPreviewValue(this.editor.getValue());\n      if(this.props.onChange){\n        this.props.onChange(this.editor.getValue());\n      }\n    });\n\n    this.editor.setValue(this.props.defaultValue || '');\n\n    // set image input\n    this.$imageInput.change(function(event){\n      let files = event.target.files;\n      if(files.length == 0)\n        return;\n      co(function * () {\n        for(let i=0; i < files.length; i++){\n          let path = files[i].path;\n          let hashKey = yield getFileHash(path);\n          let key = hash2Key(hashKey);\n          yield copyFile(path, `${FILES_PATH}/${key}`);\n          this.editor.replaceSelection(\"![\" + files[i].name + \"](\" + key + \")\");\n        }\n      });\n    });\n  }\n\n  componentWillReceiveProps(newProps){\n    this.setSize(newProps);\n    if(newProps.editorState == 1 || newProps.editorState == 2)\n      this.debouncedSetPreviewValue(this.editor.getValue());\n  }\n\n  // set editor size based on editorState\n  // 0 => normal editor, 1 => watching, 2 => preview\n  setSize = (newProps) => {\n    let props = newProps || this.props,\n      editorState = props.editorState || 0;\n    switch (editorState) {\n      // normal\n      case 0:\n        this.editor.setSize('100%', '100%');\n        this.refs.preview.setSize('0px', '0px');\n        break;\n      // watching\n      case 1:\n        this.editor.setSize('50%', '100%');\n        this.refs.preview.setSize('50%', '100%');\n        break;\n      // preview\n      case 2:\n        this.editor.setSize('0px', '0px');\n        this.refs.preview.setSize('100%', '100%');\n        break;\n      default:\n        return;\n    }\n  }\n\n  setValue = (value) => {\n    if(this.editor){\n      return this.editor.setValue(value);\n    }\n    jQuery(ReactDom.findDOMNode(this.refs.textArea)).val(value);\n  }\n\n  getValue = () => {\n    if(this.editor)\n      return this.editor.getValue();\n    return false;\n  }\n\n  clearHistory = () => {\n    if(this.editor)\n      this.editor.clearHistory();\n  }\n\n  // set keymaps\n  setKeyMaps = (newProps) => {\n    let props = newProps || this.props;\n    console.log(Object.assign({}, this.defaultKeyMaps(), props.keyMaps));\n    if(props.keyMaps && typeof props.keyMaps == 'object')\n      return this.editor.setOption('extraKeys', Object.assign({}, this.defaultKeyMaps(), props.keyMaps));\n    if(this.props.keyMaps && typeof props.keyMaps == 'function')\n      return this.editor.setOption('extraKeys', Object.assign({}, this.defaultKeyMaps(), props.keyMaps()));\n    this.editor.setOption('extraKeys', this.defaultKeyMaps());\n  }\n\n  // 这个用于以ref形式来操作editor\n  performEditor = (method) => {\n    if(!this.editor || !this.editor[method] || typeof this.editor[method] != 'function')\n      return;\n    let args = [].slice.apply(arguments, [1]);\n    this.editor[method].apply(this.editor, args);\n  }\n\n  insertImage = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    if(this.$imageInput)\n      this.$imageInput.trigger('click');\n  }\n\n  // toolbar elements\n  _renderTools = () => {\n    return (\n        <div\n          className='toolbar-container'\n        >\n          <ul\n            className='menu left'\n          >\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"undo（Cmd+Z）\"\n                unselectable=\"on\"\n                onClick={this.undo}\n              >\n                <i className=\"fa fa-undo\" name=\"undo\"></i>\n              </a>\n            </li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"redo（Cmd+Y）\"\n                unselectable=\"on\"\n                onClick={this.redo}\n              >\n                <i className=\"fa fa-repeat\" name=\"redo\"></i>\n              </a>\n            </li>\n          </ul>\n          <ul\n            className='menu right'\n          >\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"bold\"\n                unselectable=\"on\"\n                onClick={this.changeBold}\n              >\n                <i className=\"fa fa-bold\" name=\"bold\" unselectable=\"on\"></i>\n              </a>\n            </li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"italics\"\n                unselectable=\"on\"\n                onClick={this.changeItalics}\n              >\n                <i className=\"fa fa-italic\" name=\"italic\" unselectable=\"on\"></i>\n              </a>\n            </li>\n            <li\n              className=\"divider\"\n              unselectable=\"on\"\n            >|</li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"list\"\n                unselectable=\"on\"\n                onClick={this.insertUl}\n              >\n                <i\n                  className=\"fa fa-list-ul\"\n                  name=\"list-ul\"\n                  unselectable=\"on\"\n                ></i>\n              </a>\n            </li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"order list\"\n                unselectable=\"on\"\n                onClick={this.insertOl}\n              >\n                <i\n                  className=\"fa fa-list-ol\"\n                  name=\"list-ol\"\n                  unselectable=\"on\"\n                ></i>\n              </a>\n            </li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"hr\"\n                unselectable=\"on\"\n                onClick={this.insertHr}\n              >\n                <i\n                  className=\"fa fa-minus\"\n                  name=\"hr\"\n                  unselectable=\"on\"\n                ></i>\n              </a>\n            </li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"add image\"\n                unselectable=\"on\"\n                onClick={this.insertImage}\n              >\n                <i className=\"fa fa-picture-o\" name=\"image\"></i>\n              </a>\n            </li>\n            <li\n              className=\"divider\"\n              unselectable=\"on\"\n            >|</li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"watch\"\n                unselectable=\"on\"\n                onClick={this.toggleWatching}\n              >\n                <i className={this._anoteWatchingClassNames()} name=\"watch\"></i>\n              </a>\n            </li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"preview\"\n                unselectable=\"on\"\n                onClick={this.togglePreview}\n              >\n                <i className='fa fa-desktop' name=\"preview\"></i>\n              </a>\n            </li>\n            <li>\n              <a\n                href=\"javascript:;\"\n                title=\"fullscreen\"\n                unselectable=\"on\"\n                onClick={this.toggleFullscreen}\n                className={this.state.fullscreen ? 'active' : ''}\n              >\n                <i className=\"fa fa-arrows-alt\" name=\"fullscreen\"></i>\n              </a>\n            </li>\n          </ul>\n        </div>\n    )\n  }\n\n  undo = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    let doc = this.editor.getDoc();\n    if(doc)\n      doc.undo();\n  }\n\n  redo = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    let doc = this.editor.getDoc();\n    if(doc)\n      doc.redo();\n  }\n\n  toggleFullscreen = () => {\n    this.setState({\n      fullscreen: !this.state.fullscreen\n    });\n  }\n\n  toggleWatching = () => {\n    if(this.props.toggleWatching)\n      this.props.toggleWatching();\n  }\n\n  togglePreview = () => {\n    if(this.props.togglePreview)\n      this.props.togglePreview();\n  }\n\n  changeBold = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.editor.replaceSelection('**' + this.editor.getSelection() + '**');\n  }\n\n  changeItalics = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.editor.replaceSelection('*' + this.editor.getSelection() + '*');\n  }\n\n  insertHr = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.editor.replaceSelection('------------');\n  }\n\n  insertUl = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.editor.replaceSelection('- ');\n  }\n\n  insertOl = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.editor.replaceSelection('1. ');\n  }\n\n  _anoteClassNames = () => {\n    let klasses = '';\n    klasses = this.state.fullscreen ? 'anote-editor anote-fullscreen' : 'anote-editor';\n    if(this.props.editorState == 2 || this.props.withoutToolbar)\n      klasses += ' anote-without-toolbar';\n    return klasses;\n  }\n\n  _anoteWatchingClassNames = () => {\n    let klasses = '';\n    if(this.props.editorState == 1){\n      klasses += 'fa fa-eye-slash';\n    }else{\n      klasses += 'fa fa-eye';\n    }\n    return klasses;\n  }\n\n  _anotePreviewCloseBtnStyle = () => {\n    if(this.props.editorState == 2){\n      return {\n        display: 'block'\n      }\n    }\n    return {\n      display: 'none'\n    }\n  }\n\n  render() {\n    return (\n      <div\n        className={this._anoteClassNames()}\n      >\n        <Spinner show={this.state.showSpinner}/>\n        <div\n          className='content-wrapper'\n        >\n          <div\n            className={this.props.editorState == 2 || !!this.props.withoutToolbar ? 'toolbar hidden' : 'toolbar'}\n          >\n              {this._renderTools()}\n          </div>\n          <div\n            className='anote-workpanel'\n          >\n            <textarea\n              ref='textArea'\n            />\n            <input\n              type='file'\n              style={{display: 'none'}}\n              ref='imageInput'\n              accept='image/*'\n              multiple\n            />\n            <ANotePreview\n              style={{\n                position: 'absolute',\n                top: '0px',\n                right: '0px'\n              }}\n              value={this.state.previewValue}\n              ref='preview'\n            />\n            <a\n              href=\"javascript:;\"\n              className=\"fa fa-close anote-preview-close-btn\"\n              style={this._anotePreviewCloseBtnStyle()}\n              onClick={this.togglePreview}\n            ></a>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default ANoteEditor;\n"]}