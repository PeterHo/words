{"version":3,"sources":["../../../src/renderer/views/book_form.js"],"names":["FILES_PATH","BookForm","props","_changeName","event","setState","book","Object","assign","state","name","target","value","_submit","preventDefault","stopPropagation","nameErrorText","onOk","_dropImage","files","that","path","hashKey","key","imagePath","processImage","newProps","JSON","stringify","actions","onCancel","_id","open","width","height","TMP_IMAGE_PATH","objectFit","propTypes","object","bool","func"],"mappings":"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","file":"book_form.js","sourcesContent":["import path from 'path';\nimport co from 'co';\nimport React, {\n    Component,\n    PropTypes\n} from 'react';\nimport TextField from 'material-ui/TextField';\nimport Dialog from 'material-ui/Dialog';\nimport FlatButton from 'material-ui/FlatButton';\nimport DropZone from 'react-dropzone';\nimport constants from '../../constants';\nlet {\n    FILES_PATH\n} = constants;\nimport {\n    copyFile,\n    getFileHash,\n    hash2Key\n} from '../../util'\n\n// props {book, open, onCancel, onOk}\nclass BookForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      book: this.props.book,\n      nameErrorText: null,\n      processImage: false\n    }\n  }\n\n  componentWillReceiveProps(newProps) {\n    if(JSON.stringify(newProps.book) != JSON.stringify(this.state.book)) {\n      this.setState({\n        book: newProps.book,\n        nameErrorText: null\n      });\n    }\n  }\n\n  _changeName = (event) => {\n    this.setState({\n      book: Object.assign({}, this.state.book, { name: event.target.value })\n    });\n  }\n\n  _submit = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    if(this.state.book.name == '' || !this.state.book.name){\n      this.setState({\n        nameErrorText: 'need a name!!'\n      });\n      return;\n    }\n    this.props.onOk(this.state.book);\n  }\n\n  _dropImage = (files) => {\n    let that = this;\n    co(function * () {\n      let path = files[0].path;\n      let hashKey = yield getFileHash(path);\n      let key = hash2Key(hashKey);\n      yield copyFile(path, `${FILES_PATH}/${key}`);\n      that.setState({\n        book: Object.assign({}, that.state.book, { imagePath: key })\n      });\n    });\n  }\n\n  render() {\n    const actions = [\n      <FlatButton\n        label='Cancel'\n        secondary={true}\n        onTouchTap={this.props.onCancel}\n      />,\n      <FlatButton\n        label='Ok'\n        primary={true}\n        keyboardFocused={true}\n        onTouchTap={this._submit}\n      />\n    ];\n\n    return (\n      <Dialog\n        title={this.state.book._id ? 'Edit Book' : 'New Book'}\n        actions={actions}\n        open={this.props.open}\n        onRequestClose={this.props.onCancel}\n        autoScrollBodyContent={true}\n      >\n        <form onSubmit={this._submit}>\n          <TextField\n            fullWidth={true}\n            hintText=\"name of the new book\"\n            errorText={this.state.nameErrorText}\n            floatingLabelText=\"name\"\n            defaultValue={this.state.book.name}\n            onChange={this._changeName}\n          /><br/>\n          <DropZone onDrop={this._dropImage} multiple={false} style={{width: '200px', height: '200px'}}>\n            <img\n              src={this.state.book.imagePath != '' ? `${FILES_PATH}/${this.state.book.imagePath}` : constants.TMP_IMAGE_PATH}\n              style={{ height: '100%', width: '100%', objectFit: 'contain' }}\n            />\n          </DropZone>\n        </form>\n      </Dialog>\n    );\n  }\n}\n\n// strong params\nBookForm.propTypes = {\n    book: PropTypes.object,\n    open: PropTypes.bool,\n    onCancel: PropTypes.func,\n    onOk: PropTypes.func\n}\n\nexport default BookForm;\n"]}