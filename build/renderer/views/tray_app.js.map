{"version":3,"sources":["../../../src/renderer/views/tray_app.js"],"names":["TrayApp","props","getKeyMaps","that","cm","saveFile","event","preventDefault","stopPropagation","_openDialog","clear","refs","fileContent","setValue","loadDatabase","error","find","available","sort","exec","err","bks","length","setState","books","_alertNoBooks","_showSaveDialog","alertDialogOpen","_closeAlertNoBooksDialog","saveDialogOpen","titleInput","focus","_okSave","canSave","state","bookId","bookIdErrorText","title","titleErrorText","content","getValue","clearHistory","_cancelSave","_changeTitle","target","value","_changeBookId","index","saveActions","horizontal","vertical","width","height","padding","map","book","_id","name"],"mappings":"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","file":"tray_app.js","sourcesContent":["//tray menubar 速记功能\nimport React, {\n    Component\n} from 'react';\nimport ANoteEditor from './anote_editor';\nimport {\n    files,\n    books\n} from '../../main/set_db';\nimport IconMenu from 'material-ui/IconMenu';\nimport MenuItem from 'material-ui/MenuItem';\nimport Dialog from 'material-ui/Dialog';\nimport FlatButton from 'material-ui/FlatButton';\nimport TextField from 'material-ui/TextField';\nimport IconButton from 'material-ui/IconButton';\nimport MoreVertIcon from 'material-ui/svg-icons/navigation/more-vert';\nimport SelectField from 'material-ui/SelectField';\nimport sendMainCmd from '../main_util';\n\nclass TrayApp extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      bookId: null,\n      saveDialogOpen: false,\n      alertDialogOpen: false,\n      books: [],\n      titleErrorText: null,\n      bookIdErrorText: null,\n      title: null\n    }\n  }\n\n  getKeyMaps = () => {\n    var that = this;\n    return {\n      'Cmd-S': function(cm){\n        that.saveFile();\n      }\n    };\n  }\n\n  saveFile = (event) => {\n    if(event){\n      event.preventDefault();\n      event.stopPropagation();\n    }\n    this._openDialog();\n  }\n\n  clear = (event) => {\n    if(event){\n      event.preventDefault();\n      event.stopPropagation();\n    }\n    if(this.refs.fileContent)\n      this.refs.fileContent.setValue('');\n  }\n\n  _openDialog = () => {\n    var that = this;\n    books.loadDatabase((error) => {\n      if(error)\n        return;\n      books.find({available: true}).sort({ 'updatedAt': -1  }).exec((err, bks) => {\n        if(bks.length == 0) {\n          that.setState({\n            books: []\n          });\n          return that._alertNoBooks();\n        }\n        that.setState({\n          books: bks\n        }, that._showSaveDialog);\n      });\n    });\n  }\n\n  _alertNoBooks = () => {\n    this.setState({\n      alertDialogOpen: true\n    });\n  }\n\n  _closeAlertNoBooksDialog = () => {\n    this.setState({\n      alertDialogOpen: false\n    });\n  }\n\n  _showSaveDialog = () => {\n    this.setState({\n      saveDialogOpen: true\n    }, () => {\n      this.refs.titleInput.focus();\n    });\n  }\n\n  _okSave = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    let canSave = true;\n\n    // validates\n    if(!this.state.bookId || this.state.bookId == ''){\n      canSave = false;\n      this.setState({\n        bookIdErrorText: 'must choose a book!!!'\n      });\n    }\n    if(!this.state.title || this.state.title == ''){\n      canSave = false;\n      this.setState({\n        titleErrorText: 'must input a title'\n      });\n    }\n\n    // persistence\n    if(canSave){\n      // cannot save like this, because some cache I think.\n      // files.insert({\n      //   bookId: this.state.bookId,\n      //   available: true,\n      //   content: this.refs.fileContent.getValue() || '',\n      //   title: this.state.title\n      // }, (error, newFile) => {\n      //\n      // });\n      sendMainCmd('newNoteFromTray', {\n        bookId: this.state.bookId,\n        available: true,\n        content: this.refs.fileContent.getValue() || '',\n        title: this.state.title\n      });\n\n      this.setState({\n        bookId: null,\n        title: null,\n        bookIdErrorText: null,\n        titleErrorText: null,\n        saveDialogOpen: false\n      });\n      this.refs.fileContent.setValue('');\n      this.refs.fileContent.clearHistory();\n    }\n  }\n\n  _cancelSave = () => {\n    this.setState({\n      titleErrorText: null,\n      title: null,\n      saveDialogOpen: false\n    });\n  }\n\n  _changeTitle = (event) => {\n    this.setState({\n      title: event.target.value\n    });\n  }\n\n  _changeBookId = (event, index, value) => {\n    this.setState({\n      bookId: value\n    })\n  }\n\n  render () {\n    var saveActions = [\n      <FlatButton\n        label='Cancel'\n        secondary={true}\n        onTouchTap={this._cancelSave}\n      />,\n      <FlatButton\n        label='Ok'\n        primary={true}\n        keyboardFocused={true}\n        onTouchTap={this._okSave}\n      />\n    ];\n\n    return (\n      <div\n        className='tray-layout'\n      >\n        <div\n          className='tray-header'\n        >\n          <ul className=\"menu left\">\n            <li>\n              <IconMenu\n                anchorOrigin={{horizontal: 'left', vertical: 'top'}}\n                targetOrigin={{horizontal: 'left', vertical: 'top'}}\n                iconButtonElement={\n                  <IconButton style={{width: '40px', height: '40px', padding: '3px'}}><MoreVertIcon/></IconButton>\n                }\n              >\n                <MenuItem\n                  primaryText=\"save...\"\n                  onClick={this.saveFile}\n                />\n                <MenuItem\n                  primaryText=\"clear\"\n                  onClick={this.clear}\n                />\n              </IconMenu>\n            </li>\n          </ul>\n        </div>\n        <div\n          className='tray-content'\n        >\n          <ANoteEditor\n            defaultValue={this.state.content}\n            ref='fileContent'\n            editorState={0}\n            toggleWatching={function(){}}\n            togglePreview={function(){}}\n            onChange={() => {\n            }}\n            keyMaps={this.getKeyMaps()}\n            withoutToolbar={true}\n          />\n        </div>\n        <Dialog\n          title='Save File'\n          actions={saveActions}\n          open={this.state.saveDialogOpen}\n          onRequestClose={this._cancelSave}\n          autoScrollBodyContent={true}\n        >\n          <form onSubmit={this._okSave}>\n          <TextField\n            fullWidth={true}\n            hintText=\"title of the note\"\n            errorText={this.state.titleErrorText}\n            floatingLabelText=\"title\"\n            defaultValue={''}\n            onChange={this._changeTitle}\n            ref='titleInput'\n          />\n          <SelectField\n            value={this.state.bookId}\n            onChange={this._changeBookId}\n            floatingLabelText=\"select a book\"\n            errorText={this.state.bookIdErrorText}\n          >\n            {\n              this.state.books.map((book) => {\n                return (\n                  <MenuItem\n                    key={book._id}\n                    value={book._id}\n                    primaryText={book.name}\n                  />\n                )\n              })\n            }\n          </SelectField>\n          </form>\n        </Dialog>\n\n        <Dialog\n          title='Alert!!'\n          actions={[\n            <FlatButton\n              label='Ok'\n              primary={true}\n              keyboardFocused={true}\n              onTouchTap={this._closeAlertNoBooksDialog}\n            />\n          ]}\n          open={this.state.alertDialogOpen}\n          onRequestClose={this._closeAlertNoBooksDialog}\n          autoScrollBodyContent={true}\n        >\n          <br/>\n          <div>\n            before u save a note, please create a notebook first\n          </div>\n        </Dialog>\n      </div>\n    );\n  }\n}\n\nexport default TrayApp;\n"]}