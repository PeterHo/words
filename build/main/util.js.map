{"version":3,"sources":["../../src/main/util.js"],"names":["FILES_PATH","TMP_FILES_PATH","http","require","https","writeFileAsyn","promisify","writeFile","unlinkAsync","unlink","guid","s4","Math","floor","random","toString","substring","downloadAsyn","url","dest","file","createWriteStream","resolve","reject","responseSent","pModule","indexOf","get","response","pipe","on","close","console","log","err","ensureDirectoryExistence","filePath","dirname","directoryExists","mkdirSync","path","statSync","isDirectory","copyFile","source","target","rs","createReadStream","ws","buffer2File","buffer","tmpPath","Date","now","getFileHash","hashKey","key","hash2Key","downloadImageAsyn","hash","createHash","setEncoding","end","read","slice","key2path","debounce","func","wait","immediate","timeout","debounced","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","cancel","throttle","options","result","previous","getNow","getTime","leading","throttled","remaining","trailing","findIndexById","list","item","findIndex","currentItem","_id","pick","o","props","Object","assign","map","prop","chineseDate","date","tmpDate","setHours","getHours","ppDate","getMonth","getDate","getFullYear","placeImageToLocalAsyn","content","pp","ppp","m","promisesHash","exec","matchTxt","text","href","test","split","join","res","keys","forEach","module","exports"],"mappings":"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","file":"util.js","sourcesContent":["import Promise from 'bluebird';\nimport fs from 'fs';\nimport crypto from 'crypto';\nimport path from 'path';\nimport constants from './constants';\nimport co from 'co';\nlet {\n    FILES_PATH,\n    TMP_FILES_PATH\n} = constants;\nconst http = require('http');\nconst https = require('https');\n\nconst writeFileAsyn =  Promise.promisify(fs.writeFile);\n\nconst unlinkAsync = Promise.promisify(fs.unlink);\n\nfunction guid() {\n  function s4() {\n    return Math.floor((1 + Math.random()) * 0x10000)\n      .toString(16)\n      .substring(1);\n  }\n  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n    s4() + '-' + s4() + s4() + s4();\n}\n\nconst downloadAsyn = function(url, dest) {\n  let file = fs.createWriteStream(dest)\n  return new Promise((resolve, reject) => {\n    let responseSent = false,\n      pModule = null;\n    if(url.indexOf('https') > -1){\n      pModule = https;\n    }else{\n      pModule = http;\n    }\n    pModule.get(url, response => {\n      response.pipe(file)\n      file.on('finish', () =>{\n        file.close(() => {\n          if(responseSent)  return;\n          responseSent = true\n          resolve()\n        })\n      })\n    }).on('error', err => {\n      console.log('error');\n      if(responseSent)  return;\n      responseSent = true\n      reject(err)\n    })\n  })\n};\n\n// const downloadAsyn = Promise.promisify(download);\n\nfunction ensureDirectoryExistence(filePath) {\n    var dirname = path.dirname(filePath);\n    if (directoryExists(dirname)) {\n        return true;\n    }\n    ensureDirectoryExistence(dirname);\n    fs.mkdirSync(dirname);\n}\n\nfunction directoryExists(path) {\n    try {\n        return fs.statSync(path).isDirectory();\n    } catch (err) {\n        return false;\n    }\n}\n\nconst copyFile = (source, target) => {\n    return new Promise((resolve, reject) => {\n        ensureDirectoryExistence(target);\n        let rs = fs.createReadStream(source),\n            ws = fs.createWriteStream(target);\n        rs.pipe(ws);\n        ws.on('close', () => {\n            resolve();\n        });\n        ws.on('error', () => {\n            reject();\n        });\n    });\n}\n\nconst buffer2File = (buffer) => {\n  let tmpPath = path.resolve(TMP_FILES_PATH, `${Date.now()}`);\n  ensureDirectoryExistence(tmpPath);\n  return co(function * () {\n    yield writeFileAsyn(tmpPath, buffer);\n    let hashKey = yield getFileHash(tmpPath);\n    let key = hash2Key(hashKey);\n    yield copyFile(tmpPath, `${FILES_PATH}/${key}`);\n    yield unlinkAsync(tmpPath);\n    return `${key}`;\n  });\n}\n\nconst downloadImageAsyn = (url) => {\n  let tmpPath = path.resolve(TMP_FILES_PATH, `${guid()}`);\n  ensureDirectoryExistence(tmpPath);\n  return co(function * () {\n    try{\n      yield downloadAsyn(url, tmpPath);\n    // 出问题了返回原来的url\n    }catch(error){\n      console.log('出问题了返回原来的url');\n      return url;\n    }\n    let hashKey = yield getFileHash(tmpPath);\n    let key = hash2Key(hashKey);\n    yield copyFile(tmpPath, `${FILES_PATH}/${key}`);\n    yield unlinkAsync(tmpPath);\n    return `${key}`;\n  });\n}\n\nconst getFileHash = (filePath) => {\n    return new Promise((resolve, reject) => {\n        let rs = fs.createReadStream(filePath);\n        let hash = crypto.createHash('sha1');\n        hash.setEncoding('hex');\n        rs.pipe(hash);\n        rs.on('end', () => {\n            hash.end();\n            resolve(hash.read());\n        });\n    });\n}\n\nconst hash2Key = (hash) => {\n    return `${hash.slice(0, 5)}/${hash}`;\n}\n\nconst key2path = (key) => {\n    return `${FILES_PATH}/${key}`;\n}\n\nconst debounce = (func, wait, immediate) => {\n    var timeout = null,\n        debounced = function() {\n            var context = this,\n                args = arguments;\n            var later = function() {\n                timeout = null;\n                if (!immediate) func.apply(context, args);\n            };\n            var callNow = immediate && !timeout;\n            clearTimeout(timeout);\n            timeout = setTimeout(later, wait);\n            if (callNow) func.apply(context, args);\n        };\n    debounced.cancel = function() {\n        clearTimeout(timeout);\n    }\n    return debounced;\n};\n\nconst throttle = function(func, wait, options) {\n    var timeout, context, args, result;\n    var previous = 0;\n    if (!options) options = {};\n    var getNow = function() {\n        return new Date().getTime();\n    }\n    var later = function() {\n        // 如果options.leading === false在这里重新设置 previous\n        previous = options.leading === false ? 0 : getNow();\n        timeout = null;\n        result = func.apply(context, args);\n        if (!timeout) context = args = null;\n    };\n\n    var throttled = function() {\n        var now = getNow();\n        if (!previous && options.leading === false) previous = now;\n        var remaining = wait - (now - previous);\n        context = this;\n        // 但是args每次都是最新的\n        args = arguments;\n        // 距离上次的时间已经大约wait，直接运行\n        if (remaining <= 0 || remaining > wait) {\n            if (timeout) {\n                clearTimeout(timeout);\n                timeout = null;\n            }\n            previous = now;\n            result = func.apply(context, args);\n            if (!timeout) context = args = null;\n\n            // 这个是options.leading === false的时候做第一次调用\n            // 或者wait之内再调用的时候\n        } else if (!timeout && options.trailing !== false) {\n            timeout = setTimeout(later, remaining);\n        }\n\n        return result;\n    };\n\n    throttled.cancel = function() {\n        clearTimeout(timeout);\n        previous = 0;\n        timeout = context = args = null;\n    };\n\n    return throttled;\n};\n\nconst findIndexById = (list, item) => {\n    return list.findIndex((currentItem) => {\n        return currentItem._id == item._id;\n    })\n}\n\nconst pick = (o, ...props) => {\n  return Object.assign({}, ...props.map((prop) => {return {[prop]: o[prop]};}))\n}\n\nconst chineseDate = (date) => {\n  let tmpDate = new Date(date);\n  tmpDate.setHours(date.getHours() + 8);\n  return tmpDate;\n}\n\nconst ppDate = (date) => {\n  return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear().toString()}`;\n}\n\n// sequial process\n// const placeImageToLocalAsyn = (content) => {\n//   content = content || '';\n//   let pp = /!\\[(.*?)\\]\\((.*?)\\)/i;\n//   let ppp = /[http|https]/;\n//   let result = content;\n//   let m;\n//   return co (function * () {\n//     do {\n//         m = pp.exec(content);\n//         if (m) {\n//           let matchTxt = m[0];\n//           let text = m[1];\n//           let href = m[2];\n//           if(ppp.test(href)){\n//             let key = yield downloadImageAsyn(href);\n//             result = result.split(href).join(key);\n//             content = content.split(matchTxt).join('');\n//           }\n//         }\n//     } while (m);\n//     return result;\n//   });\n// }\n\n// parallel process\nconst placeImageToLocalAsyn = (content) => {\n  content = content || '';\n  let pp = /!\\[(.*?)\\]\\((.*?)\\)/i;\n  let ppp = /[http|https]/;\n  let result = content;\n  let m;\n  let promisesHash = {};\n  return co (function * () {\n    do {\n        m = pp.exec(content);\n        if (m) {\n          let matchTxt = m[0];\n          let text = m[1];\n          let href = m[2];\n          if(ppp.test(href)){\n            promisesHash[href] = downloadImageAsyn(href);\n            content = content.split(matchTxt).join('');\n          }\n        }\n    } while (m);\n    let res = yield promisesHash;\n    Object.keys(res).forEach((href) => {\n      result = result.split(href).join(res[href]);\n    });\n    return result;\n  });\n}\n\nmodule.exports = {\n    copyFile,\n    getFileHash,\n    hash2Key,\n    key2path,\n    debounce,\n    throttle,\n    findIndexById,\n    pick,\n    chineseDate,\n    ppDate,\n    buffer2File,\n    downloadImageAsyn,\n    placeImageToLocalAsyn,\n    downloadAsyn\n}\n"]}