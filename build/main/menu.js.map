{"version":3,"sources":["../../src/main/menu.js"],"names":["module","exports","init","onNotebookContainer","onEditNote","onEditTrash","onNoMainWin","onNoEditNotesList","enableItem","disableItem","electron","require","app","windows","log","BrowserWindow","menu","Menu","buildFromTemplate","getMenuTemplate","setApplicationMenu","disableMenuItems","enableMenuItems","item","tmpItem","getMenuItem","enabled","template","label","submenu","accelerator","click","main","dispatch","type","selector","role","process","platform","focusedWindow","setFullScreen","isFullScreen","dev","devSubmenu","id","getAllWindows","forEach","win","close","reload","toggleDevTools","length","name","getName","unshift","quit","i","items","menuItem","find","includes"],"mappings":"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","file":"menu.js","sourcesContent":["module.exports = {\n    init,\n    onNotebookContainer,\n    onEditNote,\n    onEditTrash,\n    onNoMainWin,\n    onNoEditNotesList,\n    enableItem,\n    disableItem\n}\n\nvar electron = require('electron')\n\nvar app = electron.app\n\nvar windows = require('./windows')\n\nvar log = require('./log').log;\n\nimport config from '../config'\n\nconst BrowserWindow = electron.BrowserWindow\n\nvar menu\n\nfunction init() {\n    menu = electron.Menu.buildFromTemplate(getMenuTemplate())\n    electron.Menu.setApplicationMenu(menu)\n}\n\n// 在notebook列表中\nfunction onNotebookContainer() {\n    disableMenuItems('Move To Notebook...',\n        'Copy To Notebook...',\n        'Move To Trash',\n        'Delete Forever',\n        'Restore...',\n        'Redo',\n        'Undo');\n}\n\n// 在编辑一个note中\nfunction onEditNote() {\n    enableMenuItems('Move To Notebook...',\n        'Copy To Notebook...',\n        'Move To Trash',\n        'Redo',\n        'Undo');\n    disableMenuItems('Delete Forever',\n        'Restore...');\n}\n\n// 在编辑状态的trash\nfunction onEditTrash() {\n    enableMenuItems('Delete Forever',\n        'Restore...');\n    disableMenuItems('Move To Notebook...',\n        'Copy To Notebook...',\n        'Move To Trash',\n        'Redo',\n        'Undo');\n}\n\n// 在没有编辑状态的notelist\nfunction onNoEditNotesList() {\n    disableMenuItems('Move To Notebook...',\n        'Copy To Notebook...',\n        'Move To Trash',\n        'Delete Forever',\n        'Restore...',\n        'Redo',\n        'Undo');\n}\n\nfunction onNoMainWin() {\n    disableMenuItems('Move To Notebook...',\n        'Copy To Notebook...',\n        'Move To Trash',\n        'Delete Forever',\n        'Restore...',\n        'Redo',\n        'Undo',\n        'New Notebook',\n        'New Note');\n}\n\nfunction enableItem(item) {\n    let tmpItem = getMenuItem(item);\n    tmpItem.enabled = true;\n}\n\nfunction disableItem(item) {\n    let tmpItem = getMenuItem(item);\n    tmpItem.enabled = false;\n}\n\nfunction getMenuTemplate() {\n    var template = [\n        {\n            label: 'Notebook',\n            submenu: [\n                {\n                    label: 'New Notebook',\n                    accelerator: 'Shift+Cmd+N',\n                    click: () => {\n                        windows.main.dispatch('newNoteBook');\n                    }\n                }\n            ]\n        },\n        {\n            label: 'Note',\n            submenu: [\n                {\n                    label: 'New Note',\n                    accelerator: 'Cmd+N',\n                    click: () => {\n                        log('new note');\n                        windows.main.dispatch('newNote');\n                    }\n                },\n                {\n                    label: 'Move To Notebook...',\n                    click: () => {\n                        log('move to notebook');\n                        windows.main.dispatch('moveToNotebook');\n                    }\n                },\n                {\n                    label: 'Copy To Notebook...',\n                    click: () => {\n                        log('copy to notebook')\n                        windows.main.dispatch('copyToNotebook');\n                    }\n                },\n                {\n                    label: 'Move To Trash',\n                    click: () => {\n                        log('move to trash');\n                        windows.main.dispatch('moveToTrash');\n                    }\n                },\n                {\n                    type: 'separator'\n                },\n                {\n                    label: 'Delete Forever',\n                    click: () => {\n                        log('delete forever')\n                        windows.main.dispatch('clearFile');\n                    }\n                },\n                {\n                    label: 'Restore...',\n                    click: () => {\n                        log('restore')\n                        windows.main.dispatch('restoreFile');\n                    }\n                }\n            ]\n        },\n        {\n            label: 'Edit',\n            submenu: [\n                {\n                    label: 'Redo',\n                    accelerator: 'Cmd+Z',\n                    click: () => {\n                        log('redo')\n                    }\n                },\n                {\n                    label: 'Undo',\n                    accelerator: 'Shft+Cmd+Z',\n                    click: () => {\n                        log('Undo')\n                    }\n                },\n                {type: \"separator\"},\n                {label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\"},\n                {label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\"},\n                {label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\"},\n                {label: \"Select All\", accelerator: \"CmdOrCtrl+A\", selector: \"selectAll:\"}\n            ]\n        },\n        {\n            label: 'Window',\n            submenu: [\n                {\n                    label: 'Minimize',\n                    accelerator: 'CmdOrCtrl+M',\n                    role: 'minimize'\n                }\n            ]\n        },\n        {\n            label: 'View',\n            submenu: [\n                {\n                    label: 'Toggle Full Screen',\n                    accelerator: (function () {\n                        if (process.platform === 'darwin') {\n                            return 'Ctrl+Command+F'\n                        } else {\n                            return 'F11'\n                        }\n                    })(),\n                    click: function (item, focusedWindow) {\n                        if (focusedWindow) {\n                            focusedWindow.setFullScreen(!focusedWindow.isFullScreen())\n                        }\n                    }\n                }\n            ]\n        }\n    ];\n\n    if (config.dev) {\n        let devSubmenu = [{\n            label: 'Reload',\n            accelerator: 'CmdOrCtrl+R',\n            click: function (item, focusedWindow) {\n                if (focusedWindow) {\n                    // on reload, start fresh and close any old\n                    // open secondary windows\n                    if (focusedWindow.id === 1) {\n                        BrowserWindow.getAllWindows().forEach(function (win) {\n                            if (win.id > 1) {\n                                win.close()\n                            }\n                        })\n                    }\n                    focusedWindow.reload()\n                }\n            }\n        },\n            {\n                label: 'Toggle Developer Tools',\n                accelerator: (function () {\n                    if (process.platform === 'darwin') {\n                        return 'Alt+Command+I'\n                    } else {\n                        return 'Ctrl+Shift+I'\n                    }\n                })(),\n                click: function (item, focusedWindow) {\n                    if (focusedWindow) {\n                        focusedWindow.toggleDevTools()\n                    }\n                }\n            }];\n        template[template.length - 1]['submenu'] = [...template[template.length - 1]['submenu'], ...devSubmenu]\n    }\n\n    if (process.platform === 'darwin') {\n        const name = electron.app.getName()\n        template.unshift({\n            label: name,\n            submenu: [{\n                label: `About ${name}`,\n                role: 'about'\n            }, {\n                type: 'separator'\n            }, {\n                label: 'Services',\n                role: 'services',\n                submenu: []\n            }, {\n                type: 'separator'\n            }, {\n                label: `Hide ${name}`,\n                accelerator: 'Command+H',\n                role: 'hide'\n            }, {\n                label: 'Hide Others',\n                accelerator: 'Command+Alt+H',\n                role: 'hideothers'\n            }, {\n                label: 'Show All',\n                role: 'unhide'\n            }, {\n                type: 'separator'\n            }, {\n                label: 'Quit',\n                accelerator: 'Command+Q',\n                click: function () {\n                    app.quit()\n                }\n            }]\n        })\n    }\n\n    return template;\n}\n\nfunction getMenuItem(label) {\n    for (var i = 0; i < menu.items.length; i++) {\n        var menuItem = menu.items[i].submenu.items.find(function (item) {\n            return item.label === label\n        })\n        if (menuItem) return menuItem\n    }\n}\n\nfunction enableMenuItems(...items) {\n    items = items || [];\n    for (var i = 0; i < menu.items.length; i++) {\n        menu.items[i].submenu.items.forEach((item) => {\n            if (items.includes(item.label))\n                item.enabled = true;\n        })\n    }\n}\n\nfunction disableMenuItems(...items) {\n    items = items || [];\n    for (var i = 0; i < menu.items.length; i++) {\n        menu.items[i].submenu.items.forEach((item) => {\n            if (items.includes(item.label))\n                item.enabled = false;\n        })\n    }\n}\n"]}