{"version":3,"sources":["../../src/main/tray.js"],"names":["path","require","events","fs","electron","app","Tray","BrowserWindow","module","exports","create","opts","dir","getAppPath","isAbsolute","resolve","index","join","windowPosition","process","platform","showDockIcon","width","height","tooltip","on","appReady","menubar","EventEmitter","setOption","opt","val","getOption","dock","hide","iconPath","icon","existsSync","__dirname","cachedBounds","defaultClickEvent","showOnRightClick","tray","clicked","setToolTip","supportsTrayHighlightState","setHighlightMode","e","preloadWindow","createWindow","showWindow","hideWindow","emit","bounds","altKey","shiftKey","ctrlKey","metaKey","window","isVisible","defaults","show","frame","winOpts","Object","assign","positioner","alwaysOnTop","emitBlur","showOnAllWorkspaces","setVisibleOnAllWorkspaces","windowClear","loadURL","trayPos","x","getBounds","noBoundsPosition","undefined","substr","position","calculate","y","setPosition"],"mappings":";;AAUA;;;;;;AAVA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,SAASD,QAAQ,QAAR,CAAb;AACA,IAAIE,KAAKF,QAAQ,IAAR,CAAT;;AAEA,IAAIG,WAAWH,QAAQ,UAAR,CAAf;AACA,IAAII,MAAMD,SAASC,GAAnB;AACA,IAAIC,OAAOF,SAASE,IAApB;AACA,IAAIC,gBAAgBH,SAASG,aAA7B;;AAKAC,OAAOC,OAAP,GAAiB,SAASC,MAAT,CAAgBC,IAAhB,EAAsB;AACnC,QAAI,OAAOA,IAAP,KAAgB,WAApB,EAAiCA,OAAO,EAACC,KAAKP,IAAIQ,UAAJ,EAAN,EAAP;AACjC,QAAI,OAAOF,IAAP,KAAgB,QAApB,EAA8BA,OAAO,EAACC,KAAKD,IAAN,EAAP;AAC9B,QAAI,CAACA,KAAKC,GAAV,EAAeD,KAAKC,GAAL,GAAWP,IAAIQ,UAAJ,EAAX;AACf,QAAI,CAAEb,KAAKc,UAAL,CAAgBH,KAAKC,GAArB,CAAN,EAAkCD,KAAKC,GAAL,GAAWZ,KAAKe,OAAL,CAAaJ,KAAKC,GAAlB,CAAX;AAClC,QAAI,CAACD,KAAKK,KAAV,EAAiBL,KAAKK,KAAL,GAAa,YAAYhB,KAAKiB,IAAL,CAAUN,KAAKC,GAAf,EAAoB,YAApB,CAAzB;AACjB,QAAI,CAACD,KAAKO,cAAV,EAA0BP,KAAKO,cAAL,GAAuBC,QAAQC,QAAR,KAAqB,OAAtB,GAAiC,kBAAjC,GAAsD,YAA5E;AAC1B,QAAI,OAAOT,KAAKU,YAAZ,KAA6B,WAAjC,EAA8CV,KAAKU,YAAL,GAAoB,KAApB;;AAE9C;AACAV,SAAKW,KAAL,GAAaX,KAAKW,KAAL,IAAc,GAA3B;AACAX,SAAKY,MAAL,GAAcZ,KAAKY,MAAL,IAAe,GAA7B;AACAZ,SAAKa,OAAL,GAAeb,KAAKa,OAAL,IAAgB,EAA/B;;AAEAnB,QAAIoB,EAAJ,CAAO,OAAP,EAAgBC,QAAhB;;AAEA,QAAIC,UAAU,IAAIzB,OAAO0B,YAAX,EAAd;AACAD,YAAQtB,GAAR,GAAcA,GAAd;;AAEA;AACAsB,YAAQE,SAAR,GAAoB,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACpCpB,aAAKmB,GAAL,IAAYC,GAAZ;AACH,KAFD;;AAIAJ,YAAQK,SAAR,GAAoB,UAAUF,GAAV,EAAe;AAC/B,eAAOnB,KAAKmB,GAAL,CAAP;AACH,KAFD;;AAIA,WAAOH,OAAP;;AAEA,aAASD,QAAT,GAAoB;AAChB,YAAIrB,IAAI4B,IAAJ,IAAY,CAACtB,KAAKU,YAAtB,EAAoChB,IAAI4B,IAAJ,CAASC,IAAT;;AAEpC,YAAIC,WAAWxB,KAAKyB,IAAL,IAAapC,KAAKiB,IAAL,CAAUN,KAAKC,GAAf,EAAoB,kBAApB,CAA5B;AACA,YAAI,CAACT,GAAGkC,UAAH,CAAcF,QAAd,CAAL,EAA8BA,WAAWnC,KAAKiB,IAAL,CAAUqB,SAAV,EAAqB,SAArB,EAAgC,kBAAhC,CAAX,CAJd,CAI6E;;AAE7F,YAAIC,YAAJ,CANgB,CAMC;AACjB,YAAIC,oBAAoB7B,KAAK8B,gBAAL,GAAwB,aAAxB,GAAwC,OAAhE;;AAEAd,gBAAQe,IAAR,GAAe/B,KAAK+B,IAAL,IAAa,IAAIpC,IAAJ,CAAS6B,QAAT,CAA5B;AACAR,gBAAQe,IAAR,CAAajB,EAAb,CAAgBe,iBAAhB,EAAmCG,OAAnC;AACAhB,gBAAQe,IAAR,CAAajB,EAAb,CAAgB,cAAhB,EAAgCkB,OAAhC;AACAhB,gBAAQe,IAAR,CAAaE,UAAb,CAAwBjC,KAAKa,OAA7B;;AAEA,YAAIqB,6BAA6B,KAAjC;AACA,YAAI;AACAlB,oBAAQe,IAAR,CAAaI,gBAAb,CAA8B,OAA9B;AACAD,yCAA6B,IAA7B;AACH,SAHD,CAGE,OAAOE,CAAP,EAAU,CACX;;AAED,YAAIpC,KAAKqC,aAAT,EAAwB;AACpBC;AACH;;AAEDtB,gBAAQuB,UAAR,GAAqBA,UAArB;AACAvB,gBAAQwB,UAAR,GAAqBA,UAArB;AACAxB,gBAAQyB,IAAR,CAAa,OAAb;;AAEA,iBAAST,OAAT,CAAiBI,CAAjB,EAAoBM,MAApB,EAA4B;AACxB,gBAAIN,EAAEO,MAAF,IAAYP,EAAEQ,QAAd,IAA0BR,EAAES,OAA5B,IAAuCT,EAAEU,OAA7C,EAAsD,OAAON,YAAP;AACtD,gBAAIxB,QAAQ+B,MAAR,IAAkB/B,QAAQ+B,MAAR,CAAeC,SAAf,EAAtB,EAAkD,OAAOR,YAAP;AAClDZ,2BAAec,UAAUd,YAAzB;AACAW,uBAAWX,YAAX;AACH;;AAED,iBAASU,YAAT,GAAwB;AACpBtB,oBAAQyB,IAAR,CAAa,eAAb;AACA,gBAAIQ,WAAW;AACXC,sBAAM,KADK;AAEXC,uBAAO;AAFI,aAAf;;AAKA,gBAAIC,UAAUC,OAAOC,MAAP,CAAc,EAAd,EAAkBL,QAAlB,EAA4BjD,IAA5B,CAAd;;AAEAgB,oBAAQ+B,MAAR,GAAiB,IAAInD,aAAJ,CAAkBwD,OAAlB,CAAjB;;AAEApC,oBAAQuC,UAAR,GAAqB,yBAAevC,QAAQ+B,MAAvB,CAArB;;AAEA/B,oBAAQ+B,MAAR,CAAejC,EAAf,CAAkB,MAAlB,EAA0B,YAAY;AAClCd,qBAAKwD,WAAL,GAAmBC,UAAnB,GAAgCjB,YAAhC;AACH,aAFD;;AAIA,gBAAIxC,KAAK0D,mBAAL,KAA6B,KAAjC,EAAwC;AACpC1C,wBAAQ+B,MAAR,CAAeY,yBAAf,CAAyC,IAAzC;AACH;;AAED3C,oBAAQ+B,MAAR,CAAejC,EAAf,CAAkB,OAAlB,EAA2B8C,WAA3B;AACA5C,oBAAQ+B,MAAR,CAAec,OAAf,CAAuB7D,KAAKK,KAA5B;AACAW,oBAAQyB,IAAR,CAAa,qBAAb;AACH;;AAED,iBAASF,UAAT,CAAoBuB,OAApB,EAA6B;AACzB,gBAAI5B,0BAAJ,EAAgClB,QAAQe,IAAR,CAAaI,gBAAb,CAA8B,QAA9B;AAChC,gBAAI,CAACnB,QAAQ+B,MAAb,EAAqB;AACjBT;AACH;;AAEDtB,oBAAQyB,IAAR,CAAa,MAAb;;AAEA,gBAAIqB,WAAWA,QAAQC,CAAR,KAAc,CAA7B,EAAgC;AAC5B;AACAnC,+BAAekC,OAAf;AACH,aAHD,MAGO,IAAIlC,YAAJ,EAAkB;AACrB;AACAkC,0BAAUlC,YAAV;AACH,aAHM,MAGA,IAAIZ,QAAQe,IAAR,CAAaiC,SAAjB,EAA4B;AAC/B;AACAF,0BAAU9C,QAAQe,IAAR,CAAaiC,SAAb,EAAV;AACH;;AAED;AACA,gBAAIC,mBAAmB,IAAvB;AACA,gBAAI,CAACH,YAAYI,SAAZ,IAAyBJ,QAAQC,CAAR,KAAc,CAAxC,KAA8C/D,KAAKO,cAAL,CAAoB4D,MAApB,CAA2B,CAA3B,EAA8B,CAA9B,MAAqC,MAAvF,EAA+F;AAC3FF,mCAAoBzD,QAAQC,QAAR,KAAqB,OAAtB,GAAiC,aAAjC,GAAiD,UAApE;AACH;;AAED,gBAAI2D,WAAWpD,QAAQuC,UAAR,CAAmBc,SAAnB,CAA6BJ,oBAAoBjE,KAAKO,cAAtD,EAAsEuD,OAAtE,CAAf;;AAEA,gBAAIC,IAAK/D,KAAK+D,CAAL,KAAWG,SAAZ,GAAyBlE,KAAK+D,CAA9B,GAAkCK,SAASL,CAAnD;AACA,gBAAIO,IAAKtE,KAAKsE,CAAL,KAAWJ,SAAZ,GAAyBlE,KAAKsE,CAA9B,GAAkCF,SAASE,CAAnD;;AAEAtD,oBAAQ+B,MAAR,CAAewB,WAAf,CAA2BR,CAA3B,EAA8BO,CAA9B;AACAtD,oBAAQ+B,MAAR,CAAeG,IAAf;AACAlC,oBAAQyB,IAAR,CAAa,YAAb;AACA;AACH;;AAED,iBAASD,UAAT,GAAsB;AAClB,gBAAIN,0BAAJ,EAAgClB,QAAQe,IAAR,CAAaI,gBAAb,CAA8B,OAA9B;AAChC,gBAAI,CAACnB,QAAQ+B,MAAb,EAAqB;AACrB/B,oBAAQyB,IAAR,CAAa,MAAb;AACAzB,oBAAQ+B,MAAR,CAAexB,IAAf;AACAP,oBAAQyB,IAAR,CAAa,YAAb;AACH;;AAED,iBAASmB,WAAT,GAAuB;AACnB,mBAAO5C,QAAQ+B,MAAf;AACA/B,oBAAQyB,IAAR,CAAa,aAAb;AACH;;AAED,iBAASgB,QAAT,GAAoB;AAChBzC,oBAAQyB,IAAR,CAAa,YAAb;AACH;;AAED;AACAH;AACH;AACJ,CApJD","file":"tray.js","sourcesContent":["var path = require('path')\nvar events = require('events')\nvar fs = require('fs')\n\nvar electron = require('electron')\nvar app = electron.app\nvar Tray = electron.Tray\nvar BrowserWindow = electron.BrowserWindow\n\n\nimport Positioner from '../positioner'\n\nmodule.exports = function create(opts) {\n    if (typeof opts === 'undefined') opts = {dir: app.getAppPath()}\n    if (typeof opts === 'string') opts = {dir: opts}\n    if (!opts.dir) opts.dir = app.getAppPath()\n    if (!(path.isAbsolute(opts.dir))) opts.dir = path.resolve(opts.dir)\n    if (!opts.index) opts.index = 'file://' + path.join(opts.dir, 'index.html')\n    if (!opts.windowPosition) opts.windowPosition = (process.platform === 'win32') ? 'trayBottomCenter' : 'trayCenter'\n    if (typeof opts.showDockIcon === 'undefined') opts.showDockIcon = false\n\n    // set width/height on opts to be usable before the window is created\n    opts.width = opts.width || 400\n    opts.height = opts.height || 400\n    opts.tooltip = opts.tooltip || ''\n\n    app.on('ready', appReady)\n\n    var menubar = new events.EventEmitter()\n    menubar.app = app\n\n    // Set / get options\n    menubar.setOption = function (opt, val) {\n        opts[opt] = val\n    }\n\n    menubar.getOption = function (opt) {\n        return opts[opt]\n    }\n\n    return menubar\n\n    function appReady() {\n        if (app.dock && !opts.showDockIcon) app.dock.hide()\n\n        var iconPath = opts.icon || path.join(opts.dir, 'IconTemplate.png')\n        if (!fs.existsSync(iconPath)) iconPath = path.join(__dirname, 'example', 'IconTemplate.png') // default cat icon\n\n        var cachedBounds // cachedBounds are needed for double-clicked event\n        var defaultClickEvent = opts.showOnRightClick ? 'right-click' : 'click'\n\n        menubar.tray = opts.tray || new Tray(iconPath)\n        menubar.tray.on(defaultClickEvent, clicked)\n        menubar.tray.on('double-click', clicked)\n        menubar.tray.setToolTip(opts.tooltip)\n\n        var supportsTrayHighlightState = false\n        try {\n            menubar.tray.setHighlightMode('never')\n            supportsTrayHighlightState = true\n        } catch (e) {\n        }\n\n        if (opts.preloadWindow) {\n            createWindow()\n        }\n\n        menubar.showWindow = showWindow\n        menubar.hideWindow = hideWindow\n        menubar.emit('ready')\n\n        function clicked(e, bounds) {\n            if (e.altKey || e.shiftKey || e.ctrlKey || e.metaKey) return hideWindow()\n            if (menubar.window && menubar.window.isVisible()) return hideWindow()\n            cachedBounds = bounds || cachedBounds\n            showWindow(cachedBounds)\n        }\n\n        function createWindow() {\n            menubar.emit('create-window')\n            var defaults = {\n                show: false,\n                frame: false\n            }\n\n            var winOpts = Object.assign({}, defaults, opts)\n\n            menubar.window = new BrowserWindow(winOpts)\n\n            menubar.positioner = new Positioner(menubar.window)\n\n            menubar.window.on('blur', function () {\n                opts.alwaysOnTop ? emitBlur() : hideWindow()\n            })\n\n            if (opts.showOnAllWorkspaces !== false) {\n                menubar.window.setVisibleOnAllWorkspaces(true)\n            }\n\n            menubar.window.on('close', windowClear)\n            menubar.window.loadURL(opts.index)\n            menubar.emit('after-create-window')\n        }\n\n        function showWindow(trayPos) {\n            if (supportsTrayHighlightState) menubar.tray.setHighlightMode('always')\n            if (!menubar.window) {\n                createWindow()\n            }\n\n            menubar.emit('show')\n\n            if (trayPos && trayPos.x !== 0) {\n                // Cache the bounds\n                cachedBounds = trayPos\n            } else if (cachedBounds) {\n                // Cached value will be used if showWindow is called without bounds data\n                trayPos = cachedBounds\n            } else if (menubar.tray.getBounds) {\n                // Get the current tray bounds\n                trayPos = menubar.tray.getBounds()\n            }\n\n            // Default the window to the right if `trayPos` bounds are undefined or null.\n            var noBoundsPosition = null\n            if ((trayPos === undefined || trayPos.x === 0) && opts.windowPosition.substr(0, 4) === 'tray') {\n                noBoundsPosition = (process.platform === 'win32') ? 'bottomRight' : 'topRight'\n            }\n\n            var position = menubar.positioner.calculate(noBoundsPosition || opts.windowPosition, trayPos)\n\n            var x = (opts.x !== undefined) ? opts.x : position.x\n            var y = (opts.y !== undefined) ? opts.y : position.y\n\n            menubar.window.setPosition(x, y)\n            menubar.window.show()\n            menubar.emit('after-show')\n            return\n        }\n\n        function hideWindow() {\n            if (supportsTrayHighlightState) menubar.tray.setHighlightMode('never')\n            if (!menubar.window) return\n            menubar.emit('hide')\n            menubar.window.hide()\n            menubar.emit('after-hide')\n        }\n\n        function windowClear() {\n            delete menubar.window\n            menubar.emit('after-close')\n        }\n\n        function emitBlur() {\n            menubar.emit('focus-lost')\n        }\n\n        // first create\n        createWindow();\n    }\n}\n"]}